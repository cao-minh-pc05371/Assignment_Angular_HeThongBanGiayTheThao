<mat-sidenav-container class="shop-container">
    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Đang tải dữ liệu...</p>
    </div>

    <!-- Error message -->
    <div *ngIf="hasError" class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ errorMessage }}</p>
        <button mat-raised-button color="primary" (click)="ngOnInit()">Thử lại</button>
    </div>

    <!-- Sidebar for categories -->
    <mat-sidenav mode="side" opened class="shop-sidebar">
        <h3>Danh Mục</h3>
        <mat-nav-list>
            <mat-list-item (click)="filterByCategory(null)" [class.active]="selectedCategoryId === null">
                <a>Tất Cả</a>
            </mat-list-item>
            <mat-list-item *ngFor="let category of categories" 
                          (click)="filterByCategory(category.id)"
                          [class.active]="selectedCategoryId === category.id">
                <a>{{ category.name }}</a>
            </mat-list-item>
        </mat-nav-list>
    </mat-sidenav>

    <!-- Main content for products -->
    <mat-sidenav-content class="shop-products">
        <h3>Sản Phẩm ({{ products ? products.length : 0 }})</h3>

        <!-- Search bar -->
        <div class="search-bar" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Tìm kiếm sản phẩm</mat-label>
                <input matInput [(ngModel)]="searchQuery" (input)="onSearch()" placeholder="Nhập tên sản phẩm">
            </mat-form-field>

            <!-- Sorting bar -->
            <mat-form-field appearance="outline" style="width: 200px;">
                <mat-label>Sắp xếp giá</mat-label>
                <mat-select (selectionChange)="sortByPrice($event.value)">
                    <mat-option [value]="'asc'">Giá: Thấp đến Cao</mat-option>
                    <mat-option [value]="'desc'">Giá: Cao đến Thấp</mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <!-- No products message -->
        <div *ngIf="!isLoading && (!filteredProducts || filteredProducts.length === 0)" class="no-products">
            <p>Không có sản phẩm nào phù hợp với bộ lọc.</p>
        </div>

        <div class="product-grid" *ngIf="filteredProducts && filteredProducts.length > 0">
            <mat-card class="product-card" *ngFor="let product of paginatedProducts">
                <mat-card-header>
                    <mat-card-title>{{ product.name }}</mat-card-title>
                    <mat-card-subtitle *ngIf="product.brand">{{ product.brand.name }}</mat-card-subtitle>
                </mat-card-header>
                <a [routerLink]="['/shop', product.id]">
                    <img mat-card-image [src]="getImageUrl(product.image)" [alt]="product.name">
                </a>
                <mat-card-content>
                    <p class="price">{{ product.price | currency:'VND':'symbol':'1.0-0' }}</p>
                    <p *ngIf="product.sale_price" class="sale-price">
                        Giảm giá: {{ product.sale_price | currency:'VND':'symbol':'1.0-0' }}
                    </p>
                    <p class="category" *ngIf="product.category">{{ product.category.name }}</p>
                </mat-card-content>
                <mat-card-actions>
                    <button mat-raised-button color="primary" (click)="buyNow(product.id || 0)">Mua ngay</button>
                </mat-card-actions>
            </mat-card>
        </div>

        <!-- Pagination controls -->
        <div class="pagination-controls" *ngIf="totalPages > 1" style="display: flex; justify-content: center; align-items: center; gap: 10px;">
            <button mat-button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
                <mat-icon>chevron_left</mat-icon>
            </button>
            <button mat-button *ngFor="let page of pages" 
                    [class.active]="currentPage === page" 
                    (click)="goToPage(page)">
                {{ page }}
            </button>
            <button mat-button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
                <mat-icon>chevron_right</mat-icon>
            </button>
        </div>
    </mat-sidenav-content>
</mat-sidenav-container>
